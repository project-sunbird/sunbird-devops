
// Importing deploy configuration
@Library('deploy-conf') _

// Defining env specific variables
def getValues() {
    if (environment == "dev") {
        return [env: 'dev',
                agent: 'general-dev']
    }
    else {
        return [env: 'staging',
                agent: 'general-staging']
    }
}

// Getting env specific values
def values = getValues()
def publicBranch = gitBranch

copyArtifacts filter: 'metadata.json', projectName: 'test/player_build'
env.imagename = sh(returnStdout: true, script: 'cat metadata.json').trim()
println imagename

// Backing up cassandra
ansiblePlugin{
    agent = build-slave
    branch = publicBranch
    image_name = imagename
    scmUrl = 'https =//github.com/project-sunbird/sunbird-devops.git'
    env = values.env
    playBook = 'docker_push.yml'
    ansibleExtraArgs = ' agent, --vault-password-file /run/secrets/vault-pass, image_name'
}
