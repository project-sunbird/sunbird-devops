---
- name: Decrypt the data first
  shell: "ansible-vault decrypt {{ lookup('fileglob', '{{inventory_dir}}/{{private_key_path}}/{{private_key_prefix}}{{item}}') }} --vault-password-file /var/lib/jenkins/secrets/vault-pass"
  with_sequence: start={{private_key_sign_start}} end={{private_key_sign_end}} stride={{private_key_sign_incr}}
  tags: pre-deploy

- name: Create the keys directory in case user is overriding the private_key_path
  file:
    path: "{{chart_path}}/keys"
    state: directory
    mode: 0755
    
- name: Copy keys directory to chart path
  synchronize:
    src: "{{inventory_dir}}/{{private_key_path}}/"
    dest: "{{chart_path}}/keys/"
    copy_links: yes
  tags: pre-deploy
