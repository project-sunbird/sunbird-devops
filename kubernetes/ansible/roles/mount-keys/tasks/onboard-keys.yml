---
- name: Onboard the credentails using the generated public key
  shell: 'curl -XPOST http://{{ private_ingressgateway_ip }}/admin-api/consumers/{{kong_consumer}}/jwt -F "key={{kong_private_key_prefix}}{{item}}" -F "algorithm=RS256" -F "rsa_public_key=@{{inventory_dir}}/{{kong_private_key_path}}/{{kong_private_key_prefix}}{{item}}"'
  args:
    warn: false
  with_sequence: start={{kong_private_key_sign_start}} end={{kong_private_key_sign_end}} stride={{kong_private_key_sign_incr}}
  when: kong_private_key_sign_start is not none and kong_private_key_sign_end is not none and kong_private_key_sign_start <= kong_private_key_sign_end and kong_private_key_user_input is not defined

- name: Onboard the credentails using the key number provided from Jenkins
  shell: 'curl -XPOST http://{{ private_ingressgateway_ip }}/admin-api/consumers/{{kong_consumer}}/jwt -F "key={{kong_private_key_prefix}}{{item}}" -F "algorithm=RS256" -F "rsa_public_key=@{{inventory_dir}}/{{kong_private_key_path}}/{{kong_private_key_prefix}}{{item}}"'
  args:
    warn: false
  when: kong_private_key_user_input is defined
  with_items:
    - "{{ kong_private_key_user_input.split(',') }}"
