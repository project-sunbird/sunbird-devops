---
# tasks file for bootstrap-k8s
- name: templating yamls to /tmp
  template:
    src: "{{ item }}.yaml"
    dest: "/tmp/{{ item }}.yaml"
  with_items: "{{ bootstrap_items }}"

- name: Creating namespace "{{ namespace }}" with istio-injection enabled
  shell: kubectl apply -f /tmp/namespace.yaml

# - name: Creating domain sssl
#   shell: |
#     cat {{ ssl_cert_file }} | kubectl apply -f
#   no_log: true

- name: Creating docker secrets
  shell: |
    kubectl create secret docker-registry {{ imagepullsecrets }} --namespace {{ namespace }} --docker-server={{vault_docker_registry_url}} --docker-username={{vault_docker_registry_user}} --docker-password={{vault_docker_registry_password}}
  no_log: no

- name: "Creating {{item}}"
  shell: "kubectl apply -f /tmp/{{ item }}.yaml"
  with_items:
    - gateway
    - serviceentry
    - virtualservice
