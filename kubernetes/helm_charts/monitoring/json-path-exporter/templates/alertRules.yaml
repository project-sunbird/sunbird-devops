---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    role: alert-rules
    app: {{ .Values.serviceMonitorLabels.release }}
    release: {{ .Values.serviceMonitorLabels.release }}
  name: {{ include "json-path-exporter.fullname" . }}-alertrule
  namespace: {{ default .Values.namespace .Release.Namespace  }}
spec:
  groups:
  - name: alertrules.service.healthcheck
    rules:
    {{ range $key := .Values.service_health_checks }}
    - alert: ServiceHealthCheck Failed
      expr: service_health_status{service_name={{ . | quote }}} == 0
      for: 5m
      labels:
        severity: critical
      annotations:
        message: The {{ . }} service overall healthcheck is failing. Please check.
        summary: The {{ . }} service overall healthcheck is failing. Please check.
    {{- end }}
