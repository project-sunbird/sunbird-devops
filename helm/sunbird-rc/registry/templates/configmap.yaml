---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-config
  namespace: {{ .Release.Namespace }}
data:
  {{- $connectionInfo_username := .Values.connectionInfo_username }}

  {{- if empty $connectionInfo_username }}
    {{- $connectionInfo_username = include "common.read.secret" (dict "ChartName" .Chart.Name "Namespace" .Release.Namespace "Name" .Values.external_secrets.postgresql_user.name "Key" .Values.external_secrets.postgresql_user.key) -}}
  {{- end -}}

{{/* Uncomment this after adding postgresql chart
  {{- if empty $connectionInfo_username }}
    {{- $connectionInfo_username = fromYaml (include (print .Subcharts.postgresql.Template.BasePath "/configmap.yaml") .Subcharts.postgresql) }}
    {{- $connectionInfo_username = get $connectionInfo_username.data .Values.external_secrets.postgresql_user.key }}
  {{- end }}
*/}}

  {{- if empty $connectionInfo_username }}
    {{- printf  "ERROR | %s | The connectionInfo_username value could not be found in values.yaml or in secrets or in subcharts" .Chart.Name | fail }}
  {{- end }}

  connectionInfo_username: {{ $connectionInfo_username }}

  {{- $connectionInfo_password := .Values.connectionInfo_password }}

  {{- if empty $connectionInfo_password }}
    {{- $connectionInfo_password = include "common.read.secret" (dict "ChartName" .Chart.Name "Namespace" .Release.Namespace "Name" .Values.external_secrets.postgresql_password.name "Key" .Values.external_secrets.postgresql_password.key) -}}
  {{- end -}}

{{/* Uncomment this after adding postgresql chart
  {{- if empty $connectionInfo_password }}
    {{- $connectionInfo_password = fromYaml (include (print .Subcharts.postgresql.Template.BasePath "/configmap.yaml") .Subcharts.postgresql) }}
    {{- $connectionInfo_password = get $connectionInfo_password.data .Values.external_secrets.postgresql_password.key }}
  {{- end }}
*/}}

  {{- if empty $connectionInfo_password }}
    {{- printf  "ERROR | %s | The connectionInfo_password value could not be found in values.yaml or in secrets or in subcharts" .Chart.Name | fail }}
  {{- end }}

  connectionInfo_password: {{ $connectionInfo_password }}

  KAFKA_ADVERTISED_LISTENERS: {{ .Values.KAFKA_ADVERTISED_LISTENERS }}
  KAFKA_BROKER_ID: {{ .Values.KAFKA_BROKER_ID | quote }}
  KAFKA_INTER_BROKER_LISTENER_NAME: {{ .Values.KAFKA_INTER_BROKER_LISTENER_NAME }}
  KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: {{ .Values.KAFKA_LISTENER_SECURITY_PROTOCOL_MAP }}
  KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: {{ .Values.KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR | quote }}
  KAFKA_ZOOKEEPER_CONNECT: {{ .Values.KAFKA_ZOOKEEPER_CONNECT }}
  ZOOKEEPER_CLIENT_PORT: {{ .Values.ZOOKEEPER_CLIENT_PORT | quote }}
  ZOOKEEPER_TICK_TIME: {{ .Values.ZOOKEEPER_TICK_TIME | quote }}
  async_enabled: {{ .Values.async_enabled | quote }}
  auditTaskExecutor_queueCapacity: {{ .Values.auditTaskExecutor_queueCapacity | quote }} 
  authentication_enabled: {{ .Values.authentication_enabled | quote }}
  connectionInfo_maxPoolSize: {{ .Values.connectionInfo_maxPoolSize | quote }}
  connectionInfo_uri: {{ .Values.connectionInfo_uri }}
  elastic_search_connection_url: {{ .Values.elastic_search_connection_url }}
  elastic_search_enabled: {{ .Values.elastic_search_enabled | quote }} 
  enable_external_templates: {{ .Values.enable_external_templates | quote }}
  kafka_bootstrap_address: {{ .Values.kafka_bootstrap_address }}
  logging.level.root: {{ .Values.logging_level_root }}
  pdf_url: {{ .Values.pdf_url }}
  search_provider: {{ .Values.search_provider }}
  search_providerName: {{ .Values.search_providerName }}
  sign_url: {{ .Values.sign_url }}
  signature_enabled: {{ .Values.signature_enabled | quote }}
  taskExecutor_index_queueCapacity: {{ .Values.taskExecutor_index_queueCapacity | quote }}
  template_base_url: {{ .Values.template_base_url }}
  webhook_enabled: {{ .Values.webhook_enabled | quote }}
  workflow.enable: {{ .Values.workflow_enable | quote }}



---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-schemas
  namespace: {{ .Values.namespace }}
data:
{{ (.Files.Glob "schemas/*").AsConfig | indent 2 }}
