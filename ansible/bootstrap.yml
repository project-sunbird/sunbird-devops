- hosts: "{{ hosts| default("all") }}"
  become: yes
  gather_facts: no
  vars_files:
    - "{{inventory_dir}}/secrets.yml"
  pre_tasks:
    - name: Python predependency
      raw: bash -c "test -e /usr/bin/python" || (sudo apt update && sudo apt install -y  python)
    - name: Installing other packages
      apt:
        state: present
        name: "{{ item }}"
      with_items:
        - python-pkg-resources
        - python-pip
  vars:
    ansible_ssh_user: "{{bootstrap_user}}"
    ansible_ssh_private_key_file: "{{bootstrap_key_path}}"
  roles:
    - bootstrap_any
  tags:
    - bootstrap_any
    - all

- hosts: "{{hosts}}"
  gather_facts: no
  become: yes
  ignore_unreachable: yes
  vars_files:
    - "{{inventory_dir}}/secrets.yml"
  roles:
    - role: azure-cli
  tags:
    - azure_cli

- hosts: "{{ hosts| default("all") }}"
  become: yes
  gather_facts: no
  ignore_unreachable: yes
  vars_files:
    - "{{inventory_dir}}/secrets.yml"
  roles:
    - vm-agents-nodeexporter
  tags:
    - node-exporter
    - all
