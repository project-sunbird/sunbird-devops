---
- name: "Push docker images to Azure container registory"
  hosts: localhost
  vars_files:
    - ['{{inventory_dir}}/secrets.yml']
  become: yes
  environment:
   PYTHONPATH: /home/ops/.local/lib/python2.7/site-packages/
  tasks:
    - name: login to ACR
      docker_login: 
        registry: "{{ vault_docker_registery_url }}"
        username: "{{ vault_docker_registery_user }}"
        password: "{{ vault_docker_registory }}"
        reauth: yes
    
    - name: Push version image to registry
      docker_image:
        name: "{{ vault_docker_registery_url }}/{{ image_name }}:{{ image_tag }}"
        push: yes

    - name: Push latest image to registry
      docker_image:
        name: "{{ vault_docker_registery_url }}/{{ image_name }}:{{ image_tag }}"
        push: yes
