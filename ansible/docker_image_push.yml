---
- name: "Push docker images to Azure container registory"
  hosts: localhost
  vars_files:
    - ['{{inventory_dir}}/secrets.yml']
  become: yes
  tasks:
    - name: login to ACR
      docker_login:
        registry: "{{ vault_docker_registery_url }}"
        username: "{{ vault_docker_registery_user }}"
        password: "{{ vault_docker_registory }}"

    - name: Push image to registry
      docker_image:
        name: "{{ hub_org }}/{{ image_name }}:{{ item }}"
        repository: "{{ vault_docker_registery_url }}"
        push: yes
      with_items:
       - "{{ image_tag }}"
       - latest
