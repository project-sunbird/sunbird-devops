groups:
- name: alertrules.kafka_lag
  rules:
  - alert: secor {{ env_name }}.events.deviceprofile.backup group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.events.deviceprofile.backup"} > {{ events_deviceprofile_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.events.deviceprofile.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.events.deviceprofile.backup
  - alert: secor {{ env_name }}.telemetry.channel.backup group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.telemetry.channel.backup"} > {{ telemetry_channel_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.telemetry.channel.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.telemetry.channel.backup
  - alert: secor {{ env_name }}.telemetry.derived.backup group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.telemetry.derived.backup"} > {{ telemetry_derived_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.telemetry.derived.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.telemetry.derived.backup
  - alert: secor {{ env_name }}.telemetry.failed.backup group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.telemetry.failed.backup"} > {{ telemetry_failed_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.telemetry.failed.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.telemetry.failed.backup
  - alert: secor {{ env_name }}.telemetry.ingestion.backup consumer group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.telemetry.ingestion.backup"} > {{ telemetry_ingestion_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.telemetry.ingestion.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.telemetry.ingestion.backup
  - alert: secor {{ env_name }}.graph.events.backup consumer group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.graph.events.backup"} > {{ graph_events_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.graph.events.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.graph.events.backup  
  - alert: secor {{ env_name }}.telemetry.raw.backup consumer group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.telemetry.raw.backup"} > {{ telemetry_raw_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.telemetry.raw.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.telemetry.raw.backup
  - alert: secor {{ env_name }}.telemetry.unique.backup consumer group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.telemetry.unique.backup"} > {{ telemetry_unique_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.telemetry.unique.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.telemetry.unique.backup
  - alert: secor {{ env_name }}.learning.failed.events.backup consumer group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.learning.failed.events.backup"} > {{ learning_failed_events_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.learning.failed.events.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.learning.failed.events.backup
  - alert: secor {{ env_name }}.telemetry.denorm.backup consumer group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.telemetry.denorm.backup"} > {{ telemetry_denorm_backup_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.telemetry.denorm.backup consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.telemetry.denorm.backup         
  - alert: secor {{ env_name }}.pipeline_metrics consumer group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.pipeline_metrics"} > {{ pipeline_metrics_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.pipeline_metrics consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.pipeline_metrics
  - alert: secor {{ env_name }}.telemetry.extractor.failed consumer group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.telemetry.extractor.failed"} > {{ telemetry_extractor_failed_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.telemetry.extractor.failed consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.telemetry.extractor.failed         
  - alert: secor {{ env_name }}.telemetry.assess consumer group lag
    expr: kafka_consumergroupzookeeper_lag_zookeeper{consumergroup="{{ env_name }}.telemetry.assess"} > {{ telemetry_assess_threshold }}
    for: 5m
    labels:
      severity: critical
    annotations:
      description: '{{ env_name }}.telemetry.assess consumer group lag is {% raw %}{{$value}}{% endraw %} for partition: {% raw %}{{ $labels.partition }}{% endraw %}'
      summary: secor consumer group lag is more for {{ env_name }}.telemetry.assess
