- name: Cassandra | Update the cassandra env configuration
  become: yes
  template: src=cassandra-env.sh dest=/etc/cassandra
  notify: "restart cassandra"
  tags:
       - provision

- name: debian | Adding Cassandra Debian Repo Key
  apt_key:
    url: "{{ cassandra_repo_key }}"
    state: "present"

- name: debian | Adding Cassandra Debian Repo
  apt_repository:
    repo: "{{ cassandra_repo }}"
    state: "present"

- name: debian | Installing Cassandra
  apt:
    name: "cassandra"
    state: "present"
# Cassandra 3.9 is not compatible with latest version of java
# So have to install older version (jre1.8.0_144)
# and that will throw dependancy ca-certs error, which is safe to skip as of now.
    dpkg_options: 'force-depends'

- name: config | Configuring Cassandra
  template:
    src: "cassandra.yaml.j2"
    dest: "{{ cassandra_root_dir }}/cassandra.yaml"
    owner: "root"
    group: "root"
    mode: 0644
  notify: "restart cassandra"
