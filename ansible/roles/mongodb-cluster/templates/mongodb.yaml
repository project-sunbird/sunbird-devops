---
- hosts: local
  #remote_user: root
  #become: yes
  tasks:
  - name: Add an Apt signing key, uses whichever key is at the URL
    ansible.builtin.apt_key:
      url: https://www.mongodb.org/static/pgp/server-4.4.asc
      state: present
  - name: Install gnupg  (state=present is optional)
    apt:
      name: gnupg
      state: present
  - name: Add an Apt signing key, uses whichever key is at the URL
    ansible.builtin.apt_key:
      url: https://www.mongodb.org/static/pgp/server-4.4.asc
      state: present
  - name: Create a list file for MongoDB
    raw: echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.4 multiverse" | tee /etc/apt/sources.list.d/mongodb-org-4.4.list
  - name: Reload local package database
    raw: apt-get update
  - name: Install the MongoDB packages
    apt:
      name: mongodb-org
      state: present
  - name: MongoDB setting
    shell:  "{{ item }}"
    loop:
      - echo "mongodb-org hold" | dpkg --set-selections
      - echo "mongodb-org-server hold" | dpkg --set-selections
      - echo "mongodb-org-shell hold" | dpkg --set-selections
      - echo "mongodb-org-mongos hold" | dpkg --set-selections
      - echo "mongodb-org-tools hold" | dpkg --set-selections
      - ulimit -f unlimited
      - ulimit -t unlimited
      - ulimit -v unlimited
      - ulimit -l unlimited
      - ulimit -n 64000
      - ulimit -m unlimited
        #      - ulimit -u 64000
  - name: Change bindIp to 0.0.0.0 in /etc/mongod.conf
    replace:
      path: /etc/mongod.conf
      regexp: 'bindIp: 127.0.0.1'
      replace: "bindIp: 0.0.0.0"
  - name: Start service mongod, if not started
    ansible.builtin.service:
      name: mongod
      state: started
  - name: Enable service mongod, and not touch the state
    ansible.builtin.service:
      name: mongod
      enabled: yes
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
1  ansible-playbook playbooks.yaml
    2  ansible local -m ping
    3  ip a
    4  tail /etc/ansible/hosts 
    5  ping 172.31.92.207
    6  cd
    7  exit
    8  passwd 
    9  cd
   10  vi /etc/ansible/hosts 
   11  cd -
   12  ls
   13  vi playbooks.yaml 
   14  systemctl restart sshd
   15  ansible local -m ping
   16  cat playbooks.yaml 
   17  vi playbooks.yaml 
   18  ansible-playbook playbooks.yaml 
   19  systemctl status mongod
   20  ulimit -a
   21  ulimit -n 64000
   22  ulimit -a
   23  ps --no-headers -o comm 1
   24  vi playbooks.yaml 
   25  ansible-playbook playbooks.yaml 
   26  vi playbooks.yaml 
   27  ansible-playbook playbooks.yaml 
   28  vi playbooks.yaml 
   29  ulimit -a
   30  ulimit -u 64000
   31  ulimit -a
   32  ansible-playbook playbooks.yaml 
   33  vi playbooks.yaml 
   34  ansible-playbook playbooks.yaml 
   35  vi playbooks.yaml 
   36  cat /etc/mongod.conf | grep -i bind
   37  cat /etc/mongod.conf | grep -i bind -C 3
   38  cat /etc/mongod.conf | grep -i bind -A 3
   39  cat /etc/mongod.conf | grep -i bind -B 3
   40  cat /etc/mongod.conf | grep -i ^bind
   41  cat /etc/mongod.conf | grep -i ^ bind
   42  cat /etc/mongod.conf | grep -i ^\ bind
   43* cat /etc/mongod.conf | grep -i bind
   44  cat /etc/mongod.conf | grep -i bind -B 3
   45  cat /etc/mongod.conf | grep -i net
   46  cat /etc/mongod.conf | grep -i ^net
   47  vi playbooks.yaml 
   48  ansible-playbook playbooks.yaml 
   49  cat /etc/mongod.conf | grep -i bind
   50  vi playbooks.yaml 
   51  ansible-playbook playbooks.yaml 
   52  cat playbooks.yaml 
   53  history
      
      
      
      
      
      
      
      
      
      
      
      
