- name: initialize python library to run keycloak bootstrap script
  shell: cd roles/keycloak/files/python-keycloak-0.12.0 && python setup.py install

- name: Save keycalok vars to json
  template: src="roles/keycloak/templates/keycloak-bootstrap.conf.j2" dest="/tmp/keycloak-bootstrap.conf.json" mode="0644"

- name: Copy realm json file to tmp location
  copy: src="roles/keycloak/files/python-keycloak-0.12.0/keycloak-realm.json" dest="/tmp" mode="0644" remote_src="yes"

- name: Copy user manager roles file to tmp location
  copy: src="roles/keycloak/files/python-keycloak-0.12.0/roles.json" dest="/tmp" mode="0644" remote_src="yes"

- name: Run the keycloak bootstrap script
  shell: cd roles/keycloak/files/python-keycloak-0.12.0/keycloak && python keycloak_main.py /tmp/keycloak-bootstrap.conf.json
