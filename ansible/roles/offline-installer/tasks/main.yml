---
- name: copy the env.json file to the repo
  template:
    src: "{{item}}.j2"
    dest: "{{offline_repo_location}}/offline-installer-repo/src/{{item}}"
    mode: '0755'
    owner: jenkins
    group: jenkins
  with_items:
    - env.json
  when: uploadInstaller is not defined

- name: copy the installer script file and build script for building offline installer
  template:
    src: "{{item}}.j2"
    dest: "{{offline_repo_location}}/offline-installer-repo/{{item}}"
    mode: '0755'
    owner: jenkins
    group: jenkins
  with_items:
    - setupOfflineInstaller.sh
    - build.sh
    - envfile
  when: uploadInstaller is not defined

- name: create a directory to store artifacts
  file:
    path: "{{offline_repo_location}}/offline-installer-repo/offline_artifacts/{{build_number}}"
    state: directory
    owner: jenkins
    group: jenkins
    recurse: yes
  when: uploadInstaller is not defined

- name: upload to azure
  include: uploadToAzure.yml
  when: uploadInstaller is defined
