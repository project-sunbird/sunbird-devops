- name: Add Azure apt repository
  apt_repository: repo='deb [arch=amd64] https://packages.microsoft.com/repos/azure-cli/ xenial main' state=present

- name: Import Azure signing key
  become: yes
  apt_key:
    url: https://packages.microsoft.com/keys/microsoft.asc
    state: present
  #shell: curl -L https://packages.microsoft.com/keys/microsoft.asc | apt-key add -

- name: ensure azure-cli and apt-transport-https is installed
  apt: name={{ item }} state=present update_cache=yes cache_valid_time=3600 allow_unauthenticated=yes
  with_items:
    - apt-transport-https 
    - azure-cli
